# Abaqus ã‚¸ãƒ§ãƒ–å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

## ğŸ“ ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€Abaqus Job Managerã«ãŠã‘ã‚‹ã‚¸ãƒ§ãƒ–å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ ã®æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’è©³è¿°ã—ã¾ã™ã€‚æ—¢å­˜ã®å¼·åŠ›ãªã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’æ´»ç”¨ã—ã€åŠ¹ç‡çš„ã§å®‰å…¨ãªã‚¸ãƒ§ãƒ–å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

## ğŸ—ï¸ å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Web Browser (Client)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  React Components                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ JobTable        â”‚  â”‚ JobDetailModal  â”‚  â”‚ ResourceMonitor â”‚ â”‚
â”‚  â”‚ (Status Display)â”‚  â”‚ (Progress View) â”‚  â”‚ (Admin Panel)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ SSE Events
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    React Router v7 Server                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Route Handlers                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ _index.tsx      â”‚  â”‚ admin.*.tsx     â”‚  â”‚ api.events.ts   â”‚ â”‚
â”‚  â”‚ (Job CRUD)      â”‚  â”‚ (Admin Panel)   â”‚  â”‚ (SSE Endpoint)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Service Layer
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Service Layer                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Job Execution Services (ç°¡ç´ åŒ–ç‰ˆ)             â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚ â”‚
â”‚  â”‚                  â”‚   AbaqusJobRunner   â”‚                   â”‚ â”‚
â”‚  â”‚                  â”‚   (çµ±åˆã‚¯ãƒ©ã‚¹)       â”‚                   â”‚ â”‚
â”‚  â”‚                  â”‚ - ãƒ•ã‚¡ã‚¤ãƒ«è»¢é€       â”‚                   â”‚ â”‚
â”‚  â”‚                  â”‚ - Abaquså®Ÿè¡Œ        â”‚                   â”‚ â”‚
â”‚  â”‚                  â”‚ - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç›£è¦–      â”‚                   â”‚ â”‚
â”‚  â”‚                  â”‚ - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°   â”‚                   â”‚ â”‚
â”‚  â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                Existing Services                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚remote-pwsh      â”‚  â”‚SSE System       â”‚  â”‚License Calc.â”‚ â”‚ â”‚
â”‚  â”‚  â”‚(SSH/PowerShell) â”‚  â”‚(Real-time)      â”‚  â”‚(Token Mgmt) â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚Scheduler System â”‚  â”‚Database Ops     â”‚  â”‚Logger Systemâ”‚ â”‚ â”‚
â”‚  â”‚  â”‚(Queue Processingâ”‚  â”‚(Type-safe CRUD) â”‚  â”‚(Structured) â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Remote Execution
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Remote Nodes (Windows)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PowerShell Scripts                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚executeAbaqus.ps1â”‚  â”‚sendDirectory.ps1â”‚  â”‚recieveDirectory â”‚ â”‚
â”‚  â”‚(Job Execution)  â”‚  â”‚(File Upload)    â”‚  â”‚(Result Download)â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚Working Directoryâ”‚  â”‚Abaqus Software  â”‚  â”‚Result Files     â”‚ â”‚
â”‚  â”‚(Job Files)      â”‚  â”‚(Solver)         â”‚  â”‚(.sta/.dat/.odb) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°è¨­è¨ˆï¼ˆç°¡ç´ åŒ–ç‰ˆï¼‰

### **1. AbaqusJobRunner (çµ±åˆã‚¸ãƒ§ãƒ–å®Ÿè¡Œã‚¯ãƒ©ã‚¹)**

```typescript
// /app/app/lib/services/abaqus/abaqus-job-runner.server.ts
interface AbaqusJobRunner {
  // ãƒ¡ã‚¤ãƒ³ã‚¸ãƒ§ãƒ–å®Ÿè¡Œãƒ¡ã‚½ãƒƒãƒ‰
  executeJob(job: Job, node: Node): Promise<JobExecutionResult>;
  
  // çµ±åˆã•ã‚ŒãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡
  private uploadFiles(job: Job, node: Node): Promise<string>; // ã‚·ãƒªã‚¢ãƒ«å‡¦ç†
  private runAbaqus(job: Job, node: Node, remotePath: string): Promise<void>; // ä¸¦åˆ—å¯èƒ½
  private downloadResults(job: Job, node: Node): Promise<string[]>; // ã‚·ãƒªã‚¢ãƒ«å‡¦ç†
  private updateJobStatus(jobId: number, status: string, message?: string): Promise<void>;
  
  // ğŸš¨ é‡è¦: ãƒ•ã‚¡ã‚¤ãƒ«è»¢é€ã‚·ãƒªã‚¢ãƒ«å‡¦ç†åˆ¶å¾¡
  private static fileTransferQueue: Map<string, Promise<void>>; // ãƒãƒ¼ãƒ‰åˆ¥è»¢é€ã‚­ãƒ¥ãƒ¼
  private static readonly maxConcurrentTransfers = 1; // è»¢é€ä¸¦åˆ—æ•°åˆ¶é™
}

interface JobExecutionResult {
  success: boolean;
  jobId: number;
  executionTime: number;
  outputFiles: string[];
  errorMessage?: string;
}
```

**ä¸»è¦æ©Ÿèƒ½**:
- **1ã¤ã®ã‚¯ãƒ©ã‚¹**ã§å®Œçµã™ã‚‹ã‚¸ãƒ§ãƒ–å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ 
- æ—¢å­˜remote-pwshãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã®çµ±åˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«è»¢é€ã‚·ãƒªã‚¢ãƒ«å‡¦ç†**ã®ç¢ºå®Ÿãªå®Ÿè£…
- åŸºæœ¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- æ—¢å­˜PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆæ´»ç”¨

**ğŸš¨ é‡è¦ãªã‚·ãƒªã‚¢ãƒ«å‡¦ç†è¦ä»¶**:
- **ãƒ•ã‚¡ã‚¤ãƒ«è»¢é€**: æº–å‚™æ®µéšï¼ˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼‰ã¨çµæœå–å¾—æ®µéšï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼‰ã¯**ã‚·ãƒªã‚¢ãƒ«å‡¦ç†**
- **Abaquså®Ÿè¡Œ**: è§£ææ®µéšã¯**ä¸¦åˆ—å‡¦ç†**å¯èƒ½
- **ç†ç”±**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¸¯åŸŸåˆ¶é™ã€ãƒ‡ã‚£ã‚¹ã‚¯I/Oåˆ¶é™ã€SSHæ¥ç¶šåˆ¶é™ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ç®¡ç†

**PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆçµ±åˆ**:
- `sendDirectory.ps1`: ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰ãƒªãƒ¢ãƒ¼ãƒˆã¸ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè»¢é€
- `receiveDirectory.ps1`: ãƒªãƒ¢ãƒ¼ãƒˆã‹ã‚‰ãƒ­ãƒ¼ã‚«ãƒ«ã¸ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè»¢é€
- PSSessionå†åˆ©ç”¨ã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªãƒ•ã‚¡ã‚¤ãƒ«è»¢é€
- ãƒãƒ¼ãƒ‰åˆ¥è»¢é€ã‚­ãƒ¥ãƒ¼ã«ã‚ˆã‚‹ã‚·ãƒªã‚¢ãƒ«å‡¦ç†åˆ¶å¾¡

### **2. æ—¢å­˜ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®çµ±åˆ**

**AbaqusJobRunner**ã¯ä»¥ä¸‹ã®æ—¢å­˜ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ´»ç”¨ï¼š

```typescript
// æ—¢å­˜ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆ
class AbaqusJobRunner {
  constructor(
    private remotePwshExecutor: RemotePwshExecutor,
    private jobOperations: JobOperations,
    private sseEmitter: SSEEmitter
  ) {}
  
  // æ—¢å­˜remote-pwshãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ´»ç”¨
  private async executePowerShellScript(
    scriptPath: string,
    args: string[]
  ): Promise<RemotePwshResult> {
    return await this.remotePwshExecutor.invokeAsync();
  }
  
  // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œæ´»ç”¨
  private async updateJobStatus(
    jobId: number,
    status: string,
    message?: string
  ): Promise<void> {
    await this.jobOperations.updateJobStatus(jobId, status, message);
  }
  
  // æ—¢å­˜SSEç™ºä¿¡æ´»ç”¨
  private async emitJobStatusUpdate(job: Job): Promise<void> {
    this.sseEmitter.emit('jobs', {
      type: 'job_status_changed',
      data: { jobId: job.id, status: job.status }
    });
  }
}
```

**çµ±åˆã•ã‚Œã‚‹ã‚µãƒ¼ãƒ“ã‚¹**:
- **remote-pwshãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ**: ã‚¸ãƒ§ãƒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
- **SSEã‚¤ãƒ™ãƒ³ãƒˆ**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥
- **æ—¢å­˜PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: ãƒ•ã‚¡ã‚¤ãƒ«è»¢é€ãƒ»Abaquså®Ÿè¡Œ

**å¿…è¦ã«å¿œã˜ã¦è¿½åŠ ã•ã‚Œã‚‹æ©Ÿèƒ½**:
- **åŸºæœ¬çš„ãªã‚­ãƒ¥ãƒ¼ã‚·ã‚¹ãƒ†ãƒ **: æ—¢å­˜ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼æ´»ç”¨
- **ç°¡å˜ãªãƒªã‚½ãƒ¼ã‚¹ç¢ºèª**: CPUã‚³ã‚¢ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç¢ºèª
- **åŸºæœ¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: å¤±æ•—æ™‚ã®å‡¦ç†
}
```

**ç°¡ç´ åŒ–ã«ã‚ˆã‚‹åˆ©ç‚¹**:
- **ä¿å®ˆæ€§**: 1ã¤ã®ã‚¯ãƒ©ã‚¹ã§å®Œçµ
- **ç†è§£ã—ã‚„ã™ã•**: è¤‡é›‘ãªä¾å­˜é–¢ä¿‚ãªã—
- **ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: å•é¡Œç®‡æ‰€ã®ç‰¹å®šãŒå®¹æ˜“
- **æ‹¡å¼µæ€§**: å¿…è¦ã«å¿œã˜ã¦æ©Ÿèƒ½è¿½åŠ å¯èƒ½

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ

### **1. ã‚¸ãƒ§ãƒ–å®Ÿè¡Œãƒ•ãƒ­ãƒ¼**

```mermaid
sequenceDiagram
    participant UI as Web UI
    participant API as Route Handler
    participant Scheduler as Job Scheduler
    participant Executor as Job Executor
    participant Transfer as File Transfer
    participant Monitor as Status Monitor
    participant Node as Remote Node
    participant DB as Database
    participant SSE as SSE System

    UI->>API: Create Job Request
    API->>DB: Insert Job (status: waiting)
    API->>SSE: Emit job_created event
    
    Scheduler->>DB: Query waiting jobs
    Scheduler->>Executor: Execute job
    Executor->>DB: Update status (starting)
    Executor->>SSE: Emit job_status_changed
    
    Executor->>Transfer: Upload files
    Transfer->>Node: sendDirectory.ps1
    Node-->>Transfer: Upload complete
    
    Executor->>Monitor: Start monitoring
    Executor->>Node: executeAbaqus.ps1
    Node-->>Monitor: Real-time output
    Monitor->>DB: Update progress
    Monitor->>SSE: Emit status updates
    
    Node-->>Executor: Execution complete
    Executor->>Transfer: Download results
    Transfer->>Node: receiveDirectory.ps1
    Node-->>Transfer: Download complete
    
    Executor->>DB: Update status (completed)
    Executor->>SSE: Emit job_status_changed
    SSE-->>UI: Real-time update
```

### **2. ã‚¨ãƒ©ãƒ¼å‡¦ç†ãƒ•ãƒ­ãƒ¼**

```mermaid
flowchart TD
    A[Job Execution] --> B{Error Occurred?}
    B -->|No| C[Continue Execution]
    B -->|Yes| D[Identify Error Type]
    
    D --> E{Network Error?}
    E -->|Yes| F[Retry with Backoff]
    E -->|No| G{Abaqus Error?}
    
    G -->|Yes| H[Parse Error Message]
    G -->|No| I{Resource Error?}
    
    I -->|Yes| J[Release Resources]
    I -->|No| K[Unknown Error]
    
    F --> L{Retry Limit?}
    L -->|Not Reached| A
    L -->|Reached| M[Mark as Failed]
    
    H --> N{Recoverable?}
    N -->|Yes| O[Automatic Recovery]
    N -->|No| M
    
    J --> P[Requeue Job]
    K --> M
    M --> Q[Cleanup Resources]
    O --> A
    P --> R[Wait for Resources]
    R --> A
```

## ğŸ—ƒï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### **æ—¢å­˜ã‚¹ã‚­ãƒ¼ãƒæ´»ç”¨**

```sql
-- Jobs table (æ—¢å­˜)
CREATE TABLE jobs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    status TEXT NOT NULL CHECK (status IN ('waiting', 'starting', 'running', 'completed', 'failed', 'missing')),
    node_id INTEGER REFERENCES nodes(id),
    file_id INTEGER NOT NULL REFERENCES file_records(id),
    user_id INTEGER NOT NULL REFERENCES users(id),
    cpu_cores INTEGER NOT NULL CHECK (cpu_cores > 0),
    priority TEXT NOT NULL DEFAULT 'normal' CHECK (priority IN ('low', 'normal', 'high', 'urgent')),
    start_time TEXT,
    end_time TEXT,
    error_message TEXT,
    output_file_path TEXT,
    created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- Job Logs table (æ—¢å­˜)
CREATE TABLE job_logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    job_id INTEGER NOT NULL REFERENCES jobs(id),
    log_level TEXT NOT NULL CHECK (log_level IN ('info', 'warning', 'error', 'debug')),
    message TEXT NOT NULL,
    details TEXT,
    created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

### **æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰**

```sql
-- Job Execution Details (optional)
CREATE TABLE job_executions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    job_id INTEGER NOT NULL REFERENCES jobs(id),
    node_id INTEGER NOT NULL REFERENCES nodes(id),
    execution_start TEXT NOT NULL,
    execution_end TEXT,
    progress_percentage INTEGER DEFAULT 0,
    memory_usage INTEGER,
    cpu_usage INTEGER,
    stdout_log TEXT,
    stderr_log TEXT,
    created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

## ğŸ”Œ SSE ã‚¤ãƒ™ãƒ³ãƒˆè¨­è¨ˆ

### **æ–°è¦ã‚¤ãƒ™ãƒ³ãƒˆå®šç¾©**

```typescript
// /app/app/lib/services/sse/sse-schemas.ts (æ‹¡å¼µ)
export const EVENT_TYPES = {
  // æ—¢å­˜ã‚¤ãƒ™ãƒ³ãƒˆ
  JOB_CREATED: 'job_created',
  JOB_UPDATED: 'job_updated',
  JOB_DELETED: 'job_deleted',
  JOB_STATUS_CHANGED: 'job_status_changed',
  
  // æ–°è¦å®Ÿè¡Œã‚¤ãƒ™ãƒ³ãƒˆ
  JOB_EXECUTION_STARTED: 'job_execution_started',
  JOB_EXECUTION_PROGRESS: 'job_execution_progress',
  JOB_EXECUTION_COMPLETED: 'job_execution_completed',
  JOB_EXECUTION_FAILED: 'job_execution_failed',
  
  // ãƒªã‚½ãƒ¼ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆ
  RESOURCE_ALLOCATED: 'resource_allocated',
  RESOURCE_RELEASED: 'resource_released',
  NODE_CAPACITY_CHANGED: 'node_capacity_changed',
} as const;

interface JobExecutionProgressData {
  jobId: number;
  jobName: string;
  nodeId: number;
  progress: number; // 0-100
  currentStep: string;
  timeRemaining?: number;
  memoryUsage?: number;
}
```

## ğŸ¢ ã‚µãƒ¼ãƒ“ã‚¹ä¾å­˜é–¢ä¿‚

### **ä¾å­˜é–¢ä¿‚ãƒãƒƒãƒ—**

```
AbaqusJobExecutor
â”œâ”€â”€ FileTransferService
â”‚   â”œâ”€â”€ remote-pwsh (existing)
â”‚   â””â”€â”€ PowerShell Scripts
â”œâ”€â”€ JobStatusMonitor
â”‚   â”œâ”€â”€ SSE System (existing)
â”‚   â””â”€â”€ Database Operations (existing)
â”œâ”€â”€ ResourceManager
â”‚   â”œâ”€â”€ License Calculator (existing)
â”‚   â””â”€â”€ Node Operations (existing)
â””â”€â”€ ErrorRecovery
    â”œâ”€â”€ Logger System (existing)
    â””â”€â”€ Database Operations (existing)

JobExecutionScheduler
â”œâ”€â”€ AbaqusJobExecutor
â”œâ”€â”€ Scheduler System (existing)
â””â”€â”€ Resource Manager
```

### **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹çµ±åˆ**

```typescript
// Service Factory Pattern
export class AbaqusExecutionServiceFactory {
  static createJobExecutor(
    transferService: FileTransferService,
    statusMonitor: JobStatusMonitor,
    resourceManager: ResourceManager
  ): AbaqusJobExecutor {
    return new AbaqusJobExecutorImpl(
      transferService,
      statusMonitor,
      resourceManager
    );
  }
}

// Dependency Injection Pattern
export interface AbaqusExecutionServices {
  jobExecutor: AbaqusJobExecutor;
  fileTransfer: FileTransferService;
  statusMonitor: JobStatusMonitor;
  resourceManager: ResourceManager;
  errorRecovery: ErrorRecoveryService;
}
```

## ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### **èªè¨¼ãƒ»èªå¯**

```typescript
// Job Execution Authorization
interface JobExecutionAuth {
  validateJobOwnership(jobId: number, userId: number): Promise<boolean>;
  checkNodeAccess(nodeId: number, userId: number): Promise<boolean>;
  validateResourceLimits(job: Job, user: User): Promise<boolean>;
}

// Secure File Transfer
interface SecureFileTransfer {
  validateFileIntegrity(file: FileRecord): Promise<boolean>;
  encryptSensitiveData(data: any): Promise<string>;
  sanitizeFilePaths(paths: string[]): string[];
}
```

### **ç›£æŸ»ãƒ­ã‚°**

```typescript
// Execution Audit Log
interface ExecutionAuditLog {
  logJobExecution(job: Job, user: User, action: string): Promise<void>;
  logResourceAllocation(allocation: ResourceAllocation): Promise<void>;
  logFileTransfer(transfer: FileTransferResult): Promise<void>;
}
```

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­è¨ˆ

### **æœ€é©åŒ–æˆ¦ç•¥**

1. **ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒªãƒ³ã‚°**: SSHæ¥ç¶šã®å†åˆ©ç”¨
2. **ä¸¦è¡Œå‡¦ç†**: è¤‡æ•°ã‚¸ãƒ§ãƒ–ã®åŒæ™‚å®Ÿè¡Œ
3. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: ãƒãƒ¼ãƒ‰æƒ…å ±ã¨ãƒªã‚½ãƒ¼ã‚¹çŠ¶æ…‹
4. **ãƒãƒƒãƒå‡¦ç†**: è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€æ‹¬è»¢é€

### **ãƒ¡ãƒ¢ãƒªç®¡ç†**

```typescript
// Resource Pool Management
interface ResourcePool {
  acquireConnection(nodeId: number): Promise<PSSession>;
  releaseConnection(session: PSSession): Promise<void>;
  cleanupIdleConnections(): Promise<void>;
}

// Memory Monitoring
interface MemoryMonitor {
  trackJobMemoryUsage(jobId: number): Promise<void>;
  alertOnHighMemoryUsage(threshold: number): Promise<void>;
  cleanupCompletedJobs(): Promise<void>;
}
```

## ğŸ” ç›£è¦–ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹

### **ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹**

```typescript
// Execution Metrics
interface ExecutionMetrics {
  totalJobsExecuted: number;
  averageExecutionTime: number;
  successRate: number;
  resourceUtilization: number;
  errorRate: number;
}

// Performance Monitoring
interface PerformanceMonitor {
  collectExecutionMetrics(): Promise<ExecutionMetrics>;
  generatePerformanceReport(): Promise<PerformanceReport>;
  alertOnPerformanceIssues(): Promise<void>;
}
```

ã“ã®æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã‚Šã€æ—¢å­˜ã®å¼·åŠ›ãªã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’æœ€å¤§é™æ´»ç”¨ã—ãªãŒã‚‰ã€å®‰å…¨ã§åŠ¹ç‡çš„ãªAbaqusã‚¸ãƒ§ãƒ–å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚